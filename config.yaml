# TradingBot Configuration
# ========================

# Trading mode: "paper" (simulated) or "live" (real money)
trading_mode: paper

# Strategies to enable
strategies:
  credit_spreads:
    enabled: true
    # "bull_put", "bear_call", or "both"
    direction: both
    # Days to expiration range
    min_dte: 20
    max_dte: 45
    # Target delta for short leg
    short_delta: 0.30
    # Width of spread in strikes
    spread_width: 5
    # Minimum credit to collect as % of spread width
    min_credit_pct: 0.30
    # Close at this % of max profit
    profit_target_pct: 0.50
    # Close at this % loss of credit received
    stop_loss_pct: 2.0

  iron_condors:
    enabled: false
    min_dte: 25
    max_dte: 50
    # Target delta for short legs
    short_delta: 0.16
    spread_width: 5
    min_credit_pct: 0.30
    profit_target_pct: 0.50
    stop_loss_pct: 2.0

  covered_calls:
    enabled: false
    min_dte: 20
    max_dte: 45
    # Target delta for calls sold
    short_delta: 0.30
    # Only sell calls on these tickers (must own shares)
    tickers: []

  naked_puts:
    enabled: false
    min_dte: 25
    max_dte: 45
    short_delta: 0.22
    profit_target_pct: 0.50
    exit_dte: 21

  calendar_spreads:
    enabled: false
    front_min_dte: 20
    front_max_dte: 30
    back_min_dte: 50
    back_max_dte: 60
    profit_target_pct: 0.25
    exit_dte: 7

# Market Scanner — dynamically finds the best stocks for options trading
# When enabled, the bot scans 150+ tickers across all sectors and ranks them
# by options volume, implied volatility, bid-ask tightness, and liquidity.
# It then trades only the top-ranked tickers each cycle.
scanner:
  enabled: true
  # How many top tickers to trade from scan results
  max_scan_results: 20
  # Cache results for 30 minutes (avoid redundant API calls)
  cache_seconds: 1800
  # Only consider stocks in this price range
  min_price: 10
  max_price: 0  # 0 = no upper limit
  # Minimum daily volume for the underlying stock
  min_underlying_volume: 500000
  # Pull trending movers from Schwab to add to the scan universe
  include_movers: true
  # Pause between ticker API calls to reduce rate-limit pressure
  request_pause_seconds: 0.10
  # Retry/backoff controls for transient quote/chain failures
  error_backoff_seconds: 1.0
  max_retry_attempts: 2
  max_consecutive_errors: 20
  # Optional cap on number of symbols scanned each cycle (0 = disabled)
  max_symbols_per_scan: 0
  # Never trade these symbols even if ranked highly
  blacklist: []
  # Ranking component weights
  movers_weight: 0.15
  sector_rotation_weight: 0.15
  relative_strength_weight: 0.20
  options_liquidity_weight: 0.15

# Fallback watchlist — only used if scanner is disabled
watchlist:
  - SPY
  - QQQ
  - IWM
  - AAPL
  - MSFT
  - AMZN
  - GOOGL
  - META
  - NVDA
  - TSLA

# Risk management
risk:
  # Max % of account value at risk across all positions
  max_portfolio_risk_pct: 5.0
  # Max % of account in a single position
  max_position_risk_pct: 2.0
  # Max number of open positions
  max_open_positions: 10
  # Max number of positions per underlying
  max_positions_per_symbol: 2
  # Min account balance to keep trading
  min_account_balance: 5000
  # Max daily loss before stopping (% of account)
  max_daily_loss_pct: 3.0
  # Proxy downside risk used for covered-call risk budgeting
  covered_call_notional_risk_pct: 20.0
  # Max absolute net portfolio delta
  max_portfolio_delta_abs: 50.0
  # Max absolute net portfolio vega as % of account value
  max_portfolio_vega_pct_of_account: 0.5
  # Max share of total deployed risk in one GICS sector
  max_sector_risk_pct: 40.0
  # Correlation guard lookback and threshold
  correlation_lookback_days: 60
  correlation_threshold: 0.8

risk_profiles:
  conservative:
    max_portfolio_risk_pct: 3.0
    max_position_risk_pct: 1.0
    max_open_positions: 5
    max_daily_loss_pct: 2.0
  moderate:
    max_portfolio_risk_pct: 5.0
    max_position_risk_pct: 2.0
    max_open_positions: 10
    max_daily_loss_pct: 3.0
  aggressive:
    max_portfolio_risk_pct: 8.0
    max_position_risk_pct: 3.0
    max_open_positions: 15
    max_daily_loss_pct: 5.0

# Scheduling
schedule:
  # Market scan times (Eastern Time, 24h format)
  scan_times:
    - "09:45"
    - "11:00"
    - "14:00"
  # Position check interval in minutes
  position_check_interval: 15
  # Only trade on weekdays
  trading_days:
    - monday
    - tuesday
    - wednesday
    - thursday
    - friday

# Live execution controls
execution:
  # Cancel stale working/queued live orders after this many minutes
  cancel_stale_orders: true
  stale_order_minutes: 20
  # Capture partial-fill quantities/prices into live ledger state
  include_partials_in_ledger: true
  # Smart execution ladder controls
  entry_step_timeout_seconds: 90
  exit_step_timeout_seconds: 60
  max_ladder_attempts: 3
  entry_ladder_shifts: [0.0, 0.25, 0.50]
  exit_ladder_shifts: [0.0, 0.25, 0.50]

# Optional LLM advisor
# Use provider "ollama" for local models on your Mac, or "openai" for cloud.
llm:
  enabled: true
  provider: openai
  model: gpt-4.1
  base_url: http://127.0.0.1:11434
  mode: advisory   # advisory | blocking
  risk_style: moderate   # conservative | moderate | aggressive
  timeout_seconds: 20
  temperature: 0.1
  min_confidence: 0.55
  track_record_file: bot/data/llm_track_record.json

# News intelligence layer
# Pulls stock-specific and market-level headlines and includes them in LLM review context.
news:
  enabled: true
  provider: google_rss
  cache_seconds: 900
  request_timeout_seconds: 10
  max_symbol_headlines: 8
  max_market_headlines: 15
  include_symbol_news: true
  include_market_news: true
  finnhub_api_key: ""
  llm_sentiment_enabled: true
  llm_sentiment_cache_seconds: 1800
  market_queries:
    - "stock market"
    - "federal reserve interest rates"
    - "inflation report"
    - "earnings season"
    - "options market volatility"

# Optional multi-account configuration
# First matching account hash is selected, and risk_profile maps into risk_profiles above.
#schwab:
#  accounts:
#    - name: aggressive
#      hash: abc123
#      risk_profile: aggressive
#    - name: conservative
#      hash: def456
#      risk_profile: conservative

# Optional alerting webhook (Slack/Teams/Discord-compatible JSON webhook)
alerts:
  enabled: false
  webhook_url: ""
  min_level: ERROR
  timeout_seconds: 5
  require_in_live: true

# Logging
logging:
  level: INFO
  file: logs/tradingbot.log
  max_bytes: 10485760
  backup_count: 5
